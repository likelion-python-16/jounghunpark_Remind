{% extends "base.html" %}
{% load static %}
{% block content %}


{% if user.is_authenticated%}
    {# --- ê²€ìƒ‰ë°” ì¶”ê°€ --- #}
    <div class="search-bar">
        <input type="text" id="searchInput" placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”." >
        <button id="searchBtn" class="btn">ê²€ìƒ‰</button>
    </div>
    {# --- ê²€ìƒ‰ë°” ë --- #}
    <div class="todocontainer"></div>
    <div class="pagination"></div>
    <button class="todoCreate" id="createBtn"> Todo ë“±ë¡í•˜ê¸°</button>
{% else %}
    <p>í•  ì¼ ëª©ë¡ì€ ë¡œê·¸ì¸ í›„ í™•ì¸ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>
{% endif %}

<script>
let currentPage = 1;
let currentSearch = ""; // ê²€ìƒ‰ì–´ ë³€ìˆ˜ ì´ˆê¸°í™”

// 1. ë¬¸ì„œê°€ ì™„ì „íˆ ë¡œë“œë˜ë©´ ì´ˆê¸°í™” í•¨ìˆ˜ ì‹¤í–‰
document.addEventListener("DOMContentLoaded", init);

// 2. ì´ˆê¸°í™”: UI ì´ë²¤íŠ¸ ì—°ê²° ë° ì²« í˜ì´ì§€ Todo ëª©ë¡ ë¡œë“œ
function init(){
    UIEvents();
    loadTodoList(1); 
}

// 2-1. UI ì´ë²¤íŠ¸ ë°”ì¸ë”©: "Todo ë“±ë¡í•˜ê¸°" ë²„íŠ¼ í´ë¦­ ì‹œ ë“±ë¡ í˜ì´ì§€ë¡œ ì´ë™
function UIEvents(){
    document.getElementById("createBtn")
    .addEventListener("click", onCreateClick);
 
    /*ê²€ìƒ‰ ë²„íŠ¼ ì´ë²¤íŠ¸ ë°”ì¸ë”©*/
    document.getElementById("searchBtn")
    .addEventListener("click", () => {
        currentSearch = document.getElementById("searchInput").value.trim(); // ì…ë ¥ê°’ì„ ì½ì–´ì˜¨ë‹¤.
        loadTodoList(1); // ìƒˆë¡œê³ ì¹¨ (list, page, search)
    });
   /*
    input ì…ë ¥ê°’ì„ ì½ì–´ì˜¨ë‹¤.
    ì•ë’¤ ê³µë°±ì„ ì œê±°í•œ ì…ë ¥ê°’ì„ ë³€ìˆ˜ì— ì €ì¥í•œë‹¤.
    ë°ì´í„° í˜¸ì¶œ(ì¬ìš”ì²­)
    */
}

// 2-1-1. ë“±ë¡ ë²„íŠ¼ í´ë¦­ ì‹œ /todo/create/ë¡œ ì´ë™
function onCreateClick(){
    window.location.href = "/todo/create/";
}

// // 3. ì„œë²„ì—ì„œ Todo ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
// function loadTodoList(page){
//     currentPage = page; // í˜„ì¬ í˜ì´ì§€ ë³€ìˆ˜ ìƒì„±
//     fetchTodoData()
//     .then(data => {
//         const todos = extractTodoArray(data); //
//         renderTodoList(todos); //íƒ¬í”Œë¦¿ì„ ê¾¸ë©°ì„œ í™”ë©´ì— ì¶œë ¥í•˜ê¸° í•¨ìˆ˜
//         renderPagination(data, Page)
//     })
//     .catch(err => console.error('ë¦¬ìŠ¤íŠ¸ ë¡œë“œ ì‹¤íŒ¨', err));
// }
// 3. ì„œë²„ì—ì„œ Todo ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
function loadTodoList(page){
    currentPage = page; // í˜„ì¬ í˜ì´ì§€ ë³€ìˆ˜ ìƒì„±
    fetchTodoData(currentPage, currentSearch)
    .then(data => {
        const todos = extractTodoArray(data); //
        renderTodoList(todos); //íƒ¬í”Œë¦¿ì„ ê¾¸ë©°ì„œ í™”ë©´ì— ì¶œë ¥í•˜ê¸° í•¨ìˆ˜
        renderPagination(data, page);
        console.log(`í˜„ì¬ í˜ì´ì§€: ${page}, ì´ í˜ì´ì§€: ${data.page_count}`);
    })
    .catch(err => console.error('ë¦¬ìŠ¤íŠ¸ ë¡œë“œ ì‹¤íŒ¨', err));
}


// 3-1. axiosë¥¼ ì´ìš©í•´ ì„œë²„ë¡œë¶€í„° íŠ¹ì • í˜ì´ì§€ì˜ Todo ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
function fetchTodoData(page, search = ""){
    return axiosInstance
    // .get(`/todo/viewsets/view/?page${currentPage}`) // í˜ì´ì§€ë„¤ì´ì…˜ ë°ì´í„° ìš”ì²­
    .get(`/todo/viewsets/view/`,{
        params: {page, search} // URL ì¿¼ë¦¬ìŠ¤íŠ¸ë§ì„ ìë™ìœ¼ë¡œ êµ¬ì„±í•´ì£¼ëŠ” ì˜µì…˜
    })
    .then(res => {
        console.log("ì‘ë‹µë°ì´í„°:", res.data)
        return res.data; // ì‘ë‹µ ë°ì´í„° ë°˜í™˜
    });
}

// 3-2. API ì‘ë‹µ í˜•ì‹ì— ë”°ë¼ Todo ë°°ì—´ ì¶”ì¶œ(í˜ì´ì§€ë„¤ì´ì…˜ë“¤ì–´ì˜¤ë©´ if ì¶”ê°€)
function extractTodoArray(data){
    if(Array.isArray(data)) return data; //ë°ì´í„° ê²€ìˆ˜
    if(Array.isArray(data.data)) return data.data;
    return [];
}

// 3-3. ì¶”ì¶œëœ Todo í•­ëª©ë“¤ì„ í™”ë©´ì— ë Œë”ë§
function renderTodoList(todos) {
    const container = document.querySelector('.todocontainer');
    container.innerHTML = '';
    todos.forEach(todo => container.appendChild(createTodoElement(todo)));
}

function createTodoElement(todo) {
    const div = document.createElement('div');
    div.className = 'todo-item';
    if (todo.complete) div.classList.add('completed');
    div.addEventListener('click', () => detailView(todo.id));

    div.innerHTML = `
        <p><strong>Name:</strong> ${todo.name}</p>
        <p><strong>Description:</strong> ${todo.description}</p>
        <p><strong>Complete:</strong> ${todo.complete}</p>
        <p><strong>Completed At:</strong> ${datetimeToString(todo.completed_at)}</p>
        <p><strong>Experience Points:</strong> ${todo.exp}</p>
        <p><strong>image:</strong><br> ${todo.image ? `<img src="${todo.image}" alt="${todo.name}" width="150">` : ''}</p>
        
        <div class="todo-interactions">
            <button class="social-btn likeBtn" data-id="${todo.id}"><span class="icon">${todo.is_liked ? 'ğŸ’”' : 'â¤ï¸'}</span> <span class="count">${todo.like_count}</span></button>
            <button class="social-btn bookmarkBtn" data-id="${todo.id}"><span class="icon">ğŸ”–</span><span class="count">${todo.bookmark_count}</span></button>
            <button class="social-btn commentToggleBtn"><span class="icon">ğŸ’¬</span><span class="count">${todo.comment_count || 0}</span></button>
            <button class="social"><a href="/interaction/todo/detail/${todo.id}/" target="_blank" class="detail-link">MYëŒ“ê¸€</a></button>
        </div>
        
        <div class="commentBox" style="display:none;">
            <ul class="commentList"></ul>
            <input type="text" class="commentInput" placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”">
            <button class="commentSubmit">ë“±ë¡</button>
        </div>
        
        <div class="todo-interactions">
            <button class="completeBtn">ì™„ë£Œ</button>
        </div>
         
        `;

    // ê¸°ì¡´ì— ìˆëŠ” í´ë¦­    
    div.querySelector('.completeBtn').addEventListener('click', e => {
        e.stopPropagation();
        toComplete(todo.id)
            .then(() => loadTodoList(currentPage)); //âœ… ì¶”ê°€
    });

    //âœ… ì¢‹ì•„ìš”
    div.querySelectorAll('.likeBtn').forEach(btn => {
        btn.addEventListener('click', function (e) {
            e.stopPropagation();
            toggleLike(btn.dataset.id); // "data-id" ì†ì„±ì— ë‹´ê¸´ ê°’ì„ ì¸ìë¡œ ì „ë‹¬í•´ì„œ toggleLike() í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•˜ë¼.
        });
    });

    //âœ… ë¶ë§ˆí¬
    div.querySelector('.bookmarkBtn').addEventListener('click', function(e) {
        e.stopPropagation();
        toggleBookmark(btn.dataset.id); 
    });

    // âœ… ëŒ“ê¸€ ë“±ë¡ ë²„íŠ¼(.commentSubmit)ì— í´ë¦­ ì´ë²¤íŠ¸ ì—°ê²°
    div.querySelector('.commentSubmit').addEventListener('click', e => {
        e.stopPropagation();
        const commentInput = div.querySelector('.commentInput');// í˜„ì¬ Todo div ë‚´ë¶€ì˜ ëŒ“ê¸€ ì…ë ¥ì°½ì„ ì°¾ëŠ”ë‹¤
        const content = commentInput.value;// ëŒ“ê¸€ ì…ë ¥ì°½ì— ì…ë ¥ëœ í…ìŠ¤íŠ¸ë¥¼ ê°€ì ¸ì˜¨ë‹¤
        if (content.trim()) { // ê³µë°±ì´ ì•„ë‹Œ ë‚´ìš©ì´ ìˆëŠ” ê²½ìš°ì—ë§Œ ë“±ë¡
            postComment(todo.id, content);// ëŒ“ê¸€ ë“±ë¡ í•¨ìˆ˜ í˜¸ì¶œ (ì„œë²„ì— ì „ì†¡)
            commentInput.value = '';// ì…ë ¥ì°½ì„ ë¹„ì›Œ ì´ˆê¸°í™”í•œë‹¤
        }
    });

    // âœ… ëŒ“ê¸€ í† ê¸€ ë²„íŠ¼(.commentToggleBtn)ì— í´ë¦­ ì´ë²¤íŠ¸ ì—°ê²°
    div.querySelector('.commentToggleBtn').addEventListener('click', e => {
        e.stopPropagation();
        const commentBox = div.querySelector('.commentBox');// âœ… ëŒ“ê¸€ í† ê¸€ ë²„íŠ¼(.commentToggleBtn)ì— í´ë¦­ ì´ë²¤íŠ¸ ì—°ê²°
        
        // í˜„ì¬ ëŒ“ê¸€ ë°•ìŠ¤ê°€ ìˆ¨ê¹€ ìƒíƒœë©´ â†’ ë³´ì´ê²Œ, ë³´ì´ëŠ” ìƒíƒœë©´ â†’ ìˆ¨ê¹€
        commentBox.style.display = (commentBox.style.display === 'none') ? 'block' : 'none';
        
        // ë§¤ê°œë³€ìˆ˜ ê°’ì€ todo pk, .commentListí´ë˜ìŠ¤ì…ë‹ˆë‹¤.
        loadComments(todo.id, div.querySelector('.commentList'));
    });

    // âœ… ëŒ“ê¸€ ì…ë ¥ì°½ í´ë¦­ ì‹œ, ìƒìœ„ div í´ë¦­ ì´ë²¤íŠ¸(ìƒì„¸í˜ì´ì§€ ì´ë™)ë¥¼ ë§‰ëŠ”ë‹¤
    div.querySelector('.commentInput')
        .addEventListener('click', e => e.stopPropagation());


    // âœ… ìƒˆì°½ ë§í¬ì˜ ì´ë²¤íŠ¸ ì „íŒŒ ì°¨ë‹¨    
    div.querySelector('.detail-link')?.addEventListener('click', e => {
    e.stopPropagation(); // ìƒìœ„ div í´ë¦­ ì´ë²¤íŠ¸ ë§‰ê¸°

    // ìƒˆì°½ ì—´ê¸° (í¬ê¸°ì™€ ìœ„ì¹˜ ì§€ì •)
    window.open(
        `/interaction/todo/detail/${todo.id}/`, // ì—´ URL
        '_blank',                               // ìƒˆì°½
        'width=600,height=600,top=100,left=200,scrollbars=yes,resizable=yes' // ì˜µì…˜
        );
    });

    return div;
}
function toggleLike(id) {
    axiosInstance.post(`/api/interaction/likes/${id}/toggle/`) // ì´ ìš”ì²­ì€ í•´ë‹¹ Todoì— ëŒ€í•´ "ì¢‹ì•„ìš”ë¥¼ ëˆ„ë¥´ê±°ë‚˜ ì·¨ì†Œ"í•˜ëŠ” ê¸°ëŠ¥ì´ë‹¤.
        .then(res => { //ì„œë²„ë¡œë¶€í„° ë°›ì€ ì‘ë‹µì—ì„œ is_likedì™€ like_count ê°’ì„ ì¶”ì¶œí•œë‹¤.
            const { is_liked, like_count } = res.data; //is_liked: í˜„ì¬ ìœ ì €ê°€ ì´ Todoë¥¼ ì¢‹ì•„ìš” ëˆŒë €ëŠ”ì§€ ì—¬ë¶€ (true/false), like_count: ì´ Todoë¥¼ ì¢‹ì•„ìš” ëˆ„ë¥¸ ì´ ì‚¬ëŒ ìˆ˜

            const btn = document.querySelector(`.likeBtn[data-id="${id}"]`);
            if (btn) btn.innerHTML = `${is_liked ? 'ğŸ’”' : 'â¤ï¸'} <span class="count">${like_count}</span>`;
            // ë²„íŠ¼ì´ ì‹¤ì œ ì¡´ì¬í•œë‹¤ë©´: ì¢‹ì•„ìš” ìƒíƒœì— ë”°ë¼ ì•„ì´ì½˜ì„ ë³€ê²½ (â¤ï¸ â†’ ì¢‹ì•„ìš” ê°€ëŠ¥, ğŸ’” â†’ ì¢‹ì•„ìš” ì·¨ì†Œ ê°€ëŠ¥), ì˜†ì— ì¢‹ì•„ìš” ìˆ˜(like_count)ë¥¼ í•¨ê»˜ ì¶œë ¥
        })
        .catch(err => console.error(" ì¢‹ì•„ìš” í† ê¸€ ì‹¤íŒ¨:", err)); 
}

//âœ… ì¶”ê°€
function toggleBookmark(id) { //ë¶ë§ˆí¬ í† ê¸€ì„ ì²˜ë¦¬í•˜ëŠ” í•¨ìˆ˜. idëŠ” Todoì˜ IDì´ë‹¤.
    axiosInstance.post(`/api/interaction/bookmarks/${id}/toggle/`)
        .then(res => {
            const { is_bookmarked, bookmark_count } = res.data; // ì„œë²„ì—ì„œ ë°›ì€ ì‘ë‹µ ê°ì²´ì—ì„œ ë¶ë§ˆí¬ ìƒíƒœì™€ ê°œìˆ˜ë¥¼ ì¶”ì¶œí•œë‹¤.
            const btn = document.querySelector(`.bookmarkBtn[data-id="${id}"]`); // DOMì—ì„œ í•´ë‹¹ Todo IDë¥¼ ê°€ì§„ ë¶ë§ˆí¬ ë²„íŠ¼ì„ ì„ íƒí•œë‹¤.
            if (btn) btn.innerHTML = `ğŸ”– <span class="count">${bookmark_count}</span>`; //ë²„íŠ¼ì´ ì¡´ì¬í•˜ë©´, ì•„ì´ì½˜ê³¼ ë¶ë§ˆí¬ ìˆ˜ë¥¼ UIì— ë°˜ì˜í•œë‹¤.
        })
        .catch(err => console.error(' ë¶ë§ˆí¬ í† ê¸€ ì‹¤íŒ¨:', err)); //ìš”ì²­ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ë©´ ì½˜ì†”ì— ì¶œë ¥í•œë‹¤.
}

//âœ… ì¶”ê°€
function toggleCommentLike(commentId) {  // âœ… ëŒ“ê¸€ì— ì¢‹ì•„ìš” í† ê¸€ì„ ì²˜ë¦¬í•˜ëŠ” í•¨ìˆ˜. commentIdëŠ” ëŒ“ê¸€ì˜ IDì´ë‹¤.
  axiosInstance.post(`/api/interaction/commentlikes/${commentId}/toggle/`) //íŠ¹ì • ëŒ“ê¸€ì— ëŒ€í•´ ì¢‹ì•„ìš”ë¥¼ ì¶”ê°€í•˜ê±°ë‚˜ ì·¨ì†Œí•˜ëŠ” ìš”ì²­ì„ ì„œë²„ë¡œ ë³´ë‚¸ë‹¤.
    .then(res => {
      const btn = document.querySelector(`.comment-like-btn[data-id="${commentId}"]`); //í•´ë‹¹ ëŒ“ê¸€ IDë¥¼ ê°€ì§„ ì¢‹ì•„ìš” ë²„íŠ¼ì„ DOMì—ì„œ ì„ íƒí•œë‹¤.
      if (btn) btn.innerHTML = `ğŸ‘ ${res.data.like_count}`;//ë²„íŠ¼ì´ ì¡´ì¬í•˜ë©´, ì¢‹ì•„ìš” ì•„ì´ì½˜ê³¼ ì¢‹ì•„ìš” ìˆ˜ë¥¼ ìƒˆë¡œ ì¶œë ¥í•œë‹¤.
    })
    .catch(err => console.error("ëŒ“ê¸€ ì¢‹ì•„ìš” ì‹¤íŒ¨:", err));//ì—ëŸ¬ ë°œìƒ ì‹œ ì½˜ì†”ì— ì‹¤íŒ¨ ë‚´ìš© ì¶œë ¥
}

//âœ… íŠ¹ì • Todoì— ëŒ“ê¸€ì„ ë“±ë¡í•˜ëŠ” í•¨ìˆ˜. todoIdëŠ” Todoì˜ ID, contentëŠ” ëŒ“ê¸€ ë‚´ìš©ì´ë‹¤.
function postComment(todoId, content) {
  if (!content) return alert("ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”");//ëŒ“ê¸€ ë‚´ìš©ì´ ì—†ìœ¼ë©´ ì‚¬ìš©ìì—ê²Œ ì…ë ¥ì„ ìš”ì²­í•˜ê³  í•¨ìˆ˜ ì‹¤í–‰ì„ ì¤‘ë‹¨í•œë‹¤.
  axiosInstance.post("/api/interaction/comments/", { todo_pk: todoId, content: content })//ì„œë²„ì— ëŒ“ê¸€ ìƒì„± ìš”ì²­ì„ ë³´ë‚¸ë‹¤.todo_pkëŠ” ì–´ë–¤ Todoì— ëŒ€í•œ ëŒ“ê¸€ì¸ì§€ ì§€ì •í•˜ëŠ” í•„ë“œì´ë‹¤.
    .then(() => {
      loadComments(todoId, document.querySelector('.commentList'));//í•´ë‹¹ Todoì— ë‹¬ë¦° ì „ì²´ ëŒ“ê¸€ì„ ë‹¤ì‹œ ë¶ˆëŸ¬ì™€ì„œ í™”ë©´ì— í‘œì‹œí•œë‹¤.
    })
    .catch(error => {
      console.error(" ëŒ“ê¸€ ë“±ë¡ ì‹¤íŒ¨:", error.response?.data || error);//ì½˜ì†”ì— ì—ëŸ¬ ë©”ì‹œì§€ ì¶œë ¥
      alert(" ëŒ“ê¸€ ë“±ë¡ ì‹¤íŒ¨:\n" + JSON.stringify(error.response?.data, null, 2));//ì‚¬ìš©ìì—ê²Œë„ ì˜¤ë¥˜ ë‚´ìš©ì„ íŒì—…ìœ¼ë¡œ ë³´ì—¬ì¤€ë‹¤.
    });
}

function loadComments(todoId, listElement) {
  // âœ… 1. ëŒ“ê¸€ ë°ì´í„°ë¥¼ ì„œë²„ì—ì„œ ê°€ì ¸ì˜¤ê¸° ìœ„í•œ GET ìš”ì²­
  axiosInstance.get(`/api/interaction/comments/`, { params: { todo_pk: todoId } })
  
    // âœ… 2. ì„œë²„ ì‘ë‹µì„ ì²˜ë¦¬í•˜ëŠ” then ë¸”ë¡ ì‹œì‘
    .then(res => {

      // âœ… 3. ì‘ë‹µ ë°ì´í„° êµ¬ì¡°ì— ë”°ë¼ ë°°ì—´ í˜•íƒœë¡œ ì •ì œí•˜ê¸°
      const payload = Array.isArray(res.data)           // 3-1. ì‘ë‹µì´ ë°°ì—´ í˜•íƒœë©´ ê·¸ëŒ€ë¡œ ì‚¬ìš©
        ? res.data
        : Array.isArray(res.data.results)               // 3-2. results í‚¤ê°€ ìˆìœ¼ë©´ ê·¸ê±¸ ì‚¬ìš©
          ? res.data.results
          : (res.data.data || []);                      // 3-3. data í‚¤ ì•ˆì— ë°°ì—´ì´ ìˆìœ¼ë©´ ì‚¬ìš©, ì—†ìœ¼ë©´ ë¹ˆ ë°°ì—´

      // âœ… 4. ëŒ“ê¸€ ë¦¬ìŠ¤íŠ¸ UIë¥¼ ì´ˆê¸°í™” (ê¸°ì¡´ ëŒ“ê¸€ë“¤ ì œê±°)
      listElement.innerHTML = '';

      // âœ… 5. ê° ëŒ“ê¸€ ê°ì²´(c)ì— ëŒ€í•´ í™”ë©´ì— ëŒ“ê¸€ í•­ëª©(li)ì„ ìƒì„±
      payload.forEach(c => {

        // âœ… 6. li ìš”ì†Œ ìƒì„±
        const li = document.createElement('li');

        // âœ… 7. ëŒ“ê¸€ ë‚´ìš© + ì¢‹ì•„ìš” ë²„íŠ¼ì„ liì— ì‚½ì… (HTML ë¬¸ìì—´ë¡œ)
        li.innerHTML = `${c.user.username || c.username}: ${c.content} 
          <button class="comment-like-btn" data-id="${c.id}">ğŸ‘ ${c.like_count}</button>`;

        // âœ… 8. ì¢‹ì•„ìš” ë²„íŠ¼ì— í´ë¦­ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€ (ëŒ“ê¸€ ì¢‹ì•„ìš” í† ê¸€)
        li.querySelector('.comment-like-btn')?.addEventListener('click', e => {
          e.stopPropagation();               // 8-1. ë¶€ëª¨ ìš”ì†Œë¡œ ì´ë²¤íŠ¸ ì „íŒŒ ë§‰ê¸°
          toggleCommentLike(c.id);          // 8-2. ëŒ“ê¸€ ì¢‹ì•„ìš” ì²˜ë¦¬ í•¨ìˆ˜ í˜¸ì¶œ
        });

        // âœ… 9. ëŒ“ê¸€ li ìš”ì†Œë¥¼ ëŒ“ê¸€ ë¦¬ìŠ¤íŠ¸ì— ì¶”ê°€
        listElement.appendChild(li);
      });
    })

    // âœ… 10. ìš”ì²­ ì‹¤íŒ¨ ì‹œ ì—ëŸ¬ ì¶œë ¥
    .catch(err => console.error('ëŒ“ê¸€ ë¡œë“œ ì‹¤íŒ¨:', err));
}
// 3-3-2. ì™„ë£Œ ë²„íŠ¼ í´ë¦­ ì‹œ í•´ë‹¹ Todo í•­ëª©ì„ ì™„ë£Œ ìƒíƒœë¡œ ë³€ê²½
function toComplete(id){
    axiosInstance.patch(`/todo/viewsets/view/
${id}/`, {complete:true}) // í˜„ì¬ í˜ì´ì§€ë¡œ ìƒˆë¡œê³ ì¹¨
    .then(() => loadTodoList(currentPage)) 
    .catch(err => console.error("ì™„ë£Œ ì²˜ë¦¬ ì‹¤íŒ¨:", err)); 
}



// 3-3-3. ìƒì„¸ í˜ì´ì§€ë¡œ ì´ë™ (â† ì´ì „, 1 2 3, â†’ ë‹¤ìŒ)
function detailView(id) {
    window.location.href = `/todo/detail/${id}/`;
}

// 3-4. í˜ì´ì§€ë„¤ì´ì…˜ êµ¬ì„± 
// function renderPagination(data, currntPage){
//     const wrapper = document.querySelector(".pagination");
//     wrapper.innerHTML = "";

//     const totalPages = data.page_count; // ì´í˜ì´ì§€ìˆ˜ë¥¼ ë³€ìˆ˜ì— ì €ì¥
    
//     // ì´ì „ í˜ì´ì§€ ë²„íŠ¼
//     const prevBtn = document.createElement("button");
//     prevBtn.innerText = "<";
//     prevBtn.disabled = !data.previous;
//     // data.previous ì´ì „ë°ì´í„° DRF ê¸°ë³¸ì ìœ¼ë¡œ ì œê³µí•´ì£¼ëŠ” í˜ì´ì§€ë„¤ì´ì…˜ ì‘ë‹µ ì†ì„± ì´ë¦„
//     prevBtn.addEventListener("click", () => loadTodoList(currntPage -1));
//     wrapper.appendChild(prevBtn);

//     // ë²ˆí˜¸ë³„ ê°œë³„ í˜ì´ì§€ ë²„íŠ¼ ìƒì„±
//     for(let i = 1;  i <= totalPages ;i++){
//         const btn = document.createElement("button");
//         Btn.innerText = i;
//         if(i === currntPage){
//             btn.disabled = true;
//             btn.classList.add("active") // cssë¡œ .active ìŠ¤íƒ€ì¼ ì§€ì •
//         }
//         btn.addEventListener("click", () => loadTodoList(i));
//         wrapper.appendChild(btn);
//     };

//     // ë‹¤ìŒ í˜ì´ì§€ ë²„íŠ¼
//     const nextBtn = document.createElement("button");
//     nextBtn.innerText = ">";
//     prevBtn.disabled = !data.next;
//     nextBtn.addEventListener("click", () => loadTodoList(currntPage +1));
//     wrapper.appendChild(nextBtn);
// }

function renderPagination(data, currentPage) {
    const wrapper = document.querySelector('.pagination');
    wrapper.innerHTML = '';

    const totalPages = data.page_count;

     // ì´ì „ í˜ì´ì§€ ë²„íŠ¼
    const prevBtn = document.createElement('button');
    prevBtn.innerText = 'â€¹';
    prevBtn.disabled = !data.previous; 
    //data.previousëŠ” Django REST Framework(DRF)ì—ì„œ ê¸°ë³¸ ì œê³µí•˜ëŠ” í˜ì´ì§€ë„¤ì´ì…˜ ì‘ë‹µ ì†ì„± ì´ë¦„ì…ë‹ˆë‹¤.
    prevBtn.addEventListener('click', () => loadTodoList(currentPage - 1));
    wrapper.appendChild(prevBtn);

    // ê°œë³„ í˜ì´ì§€ ë²„íŠ¼ë“¤ ìƒì„±
    for (let i = 1; i <= totalPages; i++) {
        const btn = document.createElement('button');
        btn.innerText = i;
        if (i === currentPage) { //ì—„ê²©í•œë¹„êµ
            btn.disabled = true;
            btn.classList.add('active');  // CSSë¡œ .active ìŠ¤íƒ€ì¼ ì§€ì •
        }
        btn.addEventListener('click', () => loadTodoList(i)); // âœ…ì˜¤íƒ€
        wrapper.appendChild(btn);
    }

    // ë‹¤ìŒ í˜ì´ì§€ ë²„íŠ¼
    const nextBtn = document.createElement('button');
    nextBtn.innerText = 'â€º';
    nextBtn.disabled = !data.next;
    nextBtn.addEventListener('click', () => loadTodoList(currentPage + 1)); // âœ…ì˜¤íƒ€
    wrapper.appendChild(nextBtn);
}

</script>  



{% endblock %}
  